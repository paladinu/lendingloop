<app-toolbar></app-toolbar>

<div class="item-requests-container">
    <div class="header">
        <h1>Item Requests</h1>
        <div class="header-stats" *ngIf="hasAnyRequests">
            <div class="stat-badge pending" *ngIf="hasPendingRequests">
                <span class="stat-number">{{ pendingRequests.length }}</span>
                <span class="stat-label">Pending</span>
            </div>
            <div class="stat-badge active" *ngIf="hasApprovedRequests">
                <span class="stat-number">{{ approvedRequests.length }}</span>
                <span class="stat-label">Active</span>
            </div>
        </div>
    </div>

    <div *ngIf="successMessage" class="alert alert-success">
        <span class="alert-icon">âœ“</span>
        <span class="alert-message">{{ successMessage }}</span>
        <button type="button" class="alert-close" (click)="successMessage = ''" aria-label="Close">Ã—</button>
    </div>

    <div *ngIf="errorMessage" class="alert alert-danger">
        <span class="alert-icon">âš </span>
        <span class="alert-message">{{ errorMessage }}</span>
        <button type="button" class="alert-close" (click)="errorMessage = ''" aria-label="Close">Ã—</button>
    </div>

    <div *ngIf="isLoading" class="loading">
        <div class="spinner"></div>
        <p>Loading requests...</p>
    </div>

    <div *ngIf="!isLoading && !hasAnyRequests" class="empty-state">
        <div class="empty-icon">ğŸ“­</div>
        <p class="empty-title">No requests yet</p>
        <p class="empty-description">When someone requests to borrow your items, they'll appear here.</p>
    </div>

    <!-- Pending Requests -->
    <div *ngIf="hasPendingRequests" class="requests-section">
        <h2 class="section-title">
            <span class="section-icon">â³</span>
            Pending Requests
        </h2>
        <div class="requests-grid">
            <div *ngFor="let request of pendingRequests" class="request-card pending-card">
                <div class="card-header">
                    <div class="item-info">
                        <h3 class="item-name">{{ request.itemName || 'Item' }}</h3>
                        <span class="status-badge pending">Pending</span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="requester-info">
                        <span class="info-icon">ğŸ‘¤</span>
                        <div class="info-text">
                            <span class="info-label">Requested by</span>
                            <span class="info-value">
                                {{ request.requesterName || 'User' }}
                                <app-loop-score-display 
                                    *ngIf="request.requesterLoopScore !== undefined" 
                                    [score]="request.requesterLoopScore" 
                                    size="small">
                                </app-loop-score-display>
                            </span>
                        </div>
                    </div>
                    <div class="date-info">
                        <span class="info-icon">ğŸ“…</span>
                        <div class="info-text">
                            <span class="info-label">Requested</span>
                            <span class="info-value">{{ request.requestedAt | date:'short' }}</span>
                        </div>
                    </div>
                    <div class="expected-return-info" *ngIf="request.expectedReturnDate">
                        <span class="info-icon">ğŸ—“ï¸</span>
                        <div class="info-text">
                            <span class="info-label">Expected return</span>
                            <span class="info-value">{{ request.expectedReturnDate | date:'mediumDate' }}</span>
                        </div>
                    </div>
                    <div class="message-section" *ngIf="request.message">
                        <div class="message-header">
                            <span class="message-icon">ğŸ’¬</span>
                            <span class="message-label">Message from requester</span>
                        </div>
                        <div class="message-content">{{ request.message }}</div>
                    </div>
                </div>
                <div class="card-actions">
                    <button type="button" class="btn btn-approve" (click)="onApprove(request)">
                        <span class="btn-icon">âœ“</span>
                        Approve
                    </button>
                    <button type="button" class="btn btn-reject" (click)="onReject(request)">
                        <span class="btn-icon">âœ•</span>
                        Reject
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Approved Requests -->
    <div *ngIf="hasApprovedRequests" class="requests-section">
        <h2 class="section-title">
            <span class="section-icon">ğŸ“¦</span>
            Currently Borrowed
        </h2>
        <div class="requests-grid">
            <div *ngFor="let request of approvedRequests" class="request-card approved-card">
                <div class="card-header">
                    <div class="item-info">
                        <h3 class="item-name">{{ request.itemName || 'Item' }}</h3>
                        <span class="status-badge approved">Active</span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="requester-info">
                        <span class="info-icon">ğŸ‘¤</span>
                        <div class="info-text">
                            <span class="info-label">Borrowed by</span>
                            <span class="info-value">
                                {{ request.requesterName || 'User' }}
                                <app-loop-score-display 
                                    *ngIf="request.requesterLoopScore !== undefined" 
                                    [score]="request.requesterLoopScore" 
                                    size="small">
                                </app-loop-score-display>
                            </span>
                        </div>
                    </div>
                    <div class="date-info">
                        <span class="info-icon">ğŸ“…</span>
                        <div class="info-text">
                            <span class="info-label">Approved</span>
                            <span class="info-value">{{ request.respondedAt | date:'short' }}</span>
                        </div>
                    </div>
                    <div class="expected-return-info" *ngIf="request.expectedReturnDate">
                        <span class="info-icon">ğŸ—“ï¸</span>
                        <div class="info-text">
                            <span class="info-label">Expected return</span>
                            <span class="info-value">{{ request.expectedReturnDate | date:'mediumDate' }}</span>
                        </div>
                    </div>
                    <div class="message-section" *ngIf="request.message">
                        <div class="message-header">
                            <span class="message-icon">ğŸ’¬</span>
                            <span class="message-label">Message from requester</span>
                        </div>
                        <div class="message-content">{{ request.message }}</div>
                    </div>
                </div>
                <div class="card-actions">
                    <button type="button" class="btn btn-complete" (click)="onComplete(request)">
                        <span class="btn-icon">âœ“</span>
                        Mark as Returned
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>