<div class="badges-container">
    <!-- Show all badges (earned and unearned) when showAllBadges is true -->
    <div *ngIf="showAllBadges && displayBadges.length > 0">
        <!-- Milestone Badges Section -->
        <div class="badge-section milestone-badges">
            <h4 class="section-title">Milestone Badges</h4>
            <div class="badge-grid">
                <div *ngFor="let badge of displayBadges | filterByCategory:'milestone'" 
                     class="badge-item"
                     [class.earned]="badge.earned"
                     [class.unearned]="!badge.earned"
                     [attr.aria-label]="badge.earned ? badge.metadata.name + ' - Earned on ' + (badge.awardedAt | date) : badge.metadata.name + ' - ' + badge.metadata.requirement">
                    <span class="badge-icon">{{ badge.metadata.icon }}</span>
                    <span class="badge-name">{{ badge.metadata.name }}</span>
                    <span class="badge-description">{{ badge.metadata.description }}</span>
                    <span class="badge-progress" *ngIf="!badge.earned && showProgress && getProgressText(badge)">{{ getProgressText(badge) }}</span>
                    <span class="badge-requirement" *ngIf="!badge.earned && (!showProgress || !getProgressText(badge))">{{ badge.metadata.requirement }}</span>
                    <span class="badge-earned-date" *ngIf="badge.earned">Earned: {{ badge.awardedAt | date }}</span>
                </div>
            </div>
        </div>
        
        <!-- Achievement Badges Section -->
        <div class="badge-section achievement-badges">
            <h4 class="section-title">Achievement Badges</h4>
            <div class="badge-grid">
                <div *ngFor="let badge of displayBadges | filterByCategory:'achievement'" 
                     class="badge-item"
                     [class.earned]="badge.earned"
                     [class.unearned]="!badge.earned"
                     [attr.aria-label]="badge.earned ? badge.metadata.name + ' - Earned on ' + (badge.awardedAt | date) : badge.metadata.name + ' - ' + badge.metadata.requirement">
                    <span class="badge-icon">{{ badge.metadata.icon }}</span>
                    <span class="badge-name">{{ badge.metadata.name }}</span>
                    <span class="badge-description">{{ badge.metadata.description }}</span>
                    <span class="badge-progress" *ngIf="!badge.earned && showProgress && getProgressText(badge)">{{ getProgressText(badge) }}</span>
                    <span class="badge-requirement" *ngIf="!badge.earned && (!showProgress || !getProgressText(badge))">{{ badge.metadata.requirement }}</span>
                    <span class="badge-earned-date" *ngIf="badge.earned">Earned: {{ badge.awardedAt | date }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Show only earned badges when showAllBadges is false (legacy mode) -->
    <div *ngIf="!showAllBadges && earnedBadges && earnedBadges.length > 0">
        <!-- Milestone Badges Section -->
        <div *ngIf="milestoneBadges.length > 0" class="badge-section milestone-badges">
            <h4 class="section-title">Milestone Badges</h4>
            <div class="badges-list">
                <div *ngFor="let badge of milestoneBadges" class="badge-item">
                    <span class="badge-icon" 
                          [class.bronze]="badge.badgeType === 'Bronze'"
                          [class.silver]="badge.badgeType === 'Silver'"
                          [class.gold]="badge.badgeType === 'Gold'"
                          [attr.aria-label]="getBadgeDescription(badge.badgeType)"
                          [title]="getBadgeDescription(badge.badgeType)">
                        ğŸ†
                    </span>
                    <div class="badge-details">
                        <div class="badge-title">{{ badge.badgeType }} Badge</div>
                        <div class="badge-description">{{ getBadgeRequirement(badge.badgeType) }}</div>
                        <div class="badge-date">Earned {{ badge.awardedAt | date: 'mediumDate' }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Achievement Badges Section -->
        <div *ngIf="achievementBadges.length > 0" class="badge-section achievement-badges">
            <h4 class="section-title">Achievement Badges</h4>
            <div class="badges-list">
                <div *ngFor="let badge of achievementBadges" class="badge-item">
                    <span class="badge-icon achievement"
                          [class.first-lend]="badge.badgeType === 'FirstLend'"
                          [class.reliable-borrower]="badge.badgeType === 'ReliableBorrower'"
                          [class.generous-lender]="badge.badgeType === 'GenerousLender'"
                          [class.perfect-record]="badge.badgeType === 'PerfectRecord'"
                          [class.community-builder]="badge.badgeType === 'CommunityBuilder'"
                          [attr.aria-label]="getBadgeDescription(badge.badgeType)"
                          [title]="getBadgeDescription(badge.badgeType)">
                        {{ getBadgeIcon(badge.badgeType) }}
                    </span>
                    <div class="badge-details">
                        <div class="badge-title">{{ getBadgeLabel(badge.badgeType) }}</div>
                        <div class="badge-description">{{ getBadgeRequirement(badge.badgeType) }}</div>
                        <div class="badge-date">Earned {{ badge.awardedAt | date: 'mediumDate' }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div *ngIf="!showAllBadges && (!earnedBadges || earnedBadges.length === 0)" class="empty-state">
        <p class="empty-message">No badges earned yet. Keep participating to earn badges!</p>
    </div>
</div>
